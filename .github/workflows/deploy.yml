name: Build and Deploy Website
on:
  push:
    branches:
      - master
jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: Deploy
    steps:
      - run: apt install pandoc
      - uses: actions/setup-python@v3
        with:
          python-version: '3.x'
      - shell: bash
        run: pip3 install virtualenv
      - uses: actions/checkout@v2
        with:
          path: vercors-web
      - uses: actions/checkout@v2
        with:
          repository: utwente-fmt/vercors-web-build
          path: vercors-web-build
          token: ${{ secrets.VERCORS_BOT_PAT }}
      - run: cd vercors-web
      - run: virtualenv venv -p python3
      - run: source venv/bin/activate
      - run: pip install -r requirements.txt
      - run: python build.py
      - run: cd ..
      - run: rm -r vercors-web-build/pub/*
      - run: cp -r vercors-web/build/* vercors-web-build/pub
      - run: ls -l vercors/web-build/pub